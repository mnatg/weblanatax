var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _firestore=_interopRequireDefault(require("@react-native-firebase/firestore"));var _messaging=_interopRequireDefault(require("@react-native-firebase/messaging"));var _reactNativeFlashMessage=require("react-native-flash-message");var _Theme=require("../../../../../Theme");var _reactRedux=require("react-redux");var _Token=require("../../Store/actions/Token");var notification=function notification(uid){var authStatus,enabled,token;return _regenerator.default.async(function notification$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _regenerator.default.awrap((0,_messaging.default)().requestPermission());case 3:authStatus=_context2.sent;enabled=authStatus===_messaging.default.AuthorizationStatus.AUTHORIZED||authStatus===_messaging.default.AuthorizationStatus.PROVISIONAL;_context2.next=7;return _regenerator.default.awrap((0,_messaging.default)().getToken());case 7:token=_context2.sent;setData(token,uid);_context2.next=11;return _regenerator.default.awrap((0,_messaging.default)().onMessage(function _callee(remoteMessage){return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:(0,_reactNativeFlashMessage.showMessage)({message:remoteMessage.notification.title,description:remoteMessage.notification.body,backgroundColor:_Theme.Colors.shadowGray,color:_Theme.Colors.aquamarine,textStyle:{color:'#000000'}});case 1:case"end":return _context.stop();}}},null,null,null,Promise);}));case 11:return _context2.abrupt("return",token);case 14:_context2.prev=14;_context2.t0=_context2["catch"](0);console.error("Error al recibir notificacion: ",_context2.t0);case 17:case"end":return _context2.stop();}}},null,null,[[0,14]],Promise);};var setData=function setData(token,uid){var token_data;return _regenerator.default.async(function setData$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:token_data={userId:uid,token:token};(0,_firestore.default)().collection('FMC_Tokens').doc(token).set(token_data).then(function(){console.log("Se ha escrito token de : "+uid);}).catch(function(e){console.error("Error adding: ",e);});case 2:case"end":return _context3.stop();}}},null,null,null,Promise);};var _default=notification;exports.default=_default;