var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _regeneratorRuntime2=require("@babel/runtime/regenerator");Object.defineProperty(exports,"__esModule",{value:true});exports.signUp=signUp;exports.logOut=logOut;exports.signIn=signIn;exports.googleSignIn=googleSignIn;exports.googleSignUp=googleSignUp;exports.facebookSignIn=facebookSignIn;exports.facebookSignUp=facebookSignUp;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _reactRedux=require("react-redux");var _reactNative=require("react-native");var _CreateUser=_interopRequireDefault(require("../../Services/User/CreateUser"));var _LogIn=_interopRequireDefault(require("../../Services/User/LogIn"));var _Types=require("../../../../../Store/Types");var _effects=require("redux-saga/effects");var _auth=_interopRequireDefault(require("@react-native-firebase/auth"));var _googleSignin=require("@react-native-community/google-signin");var _reactNativeFbsdk=require("react-native-fbsdk");var _reactNativeSimpleToast=_interopRequireDefault(require("react-native-simple-toast"));var _marked=_regeneratorRuntime2.mark(signUp),_marked2=_regeneratorRuntime2.mark(logOut),_marked3=_regeneratorRuntime2.mark(signIn),_marked4=_regeneratorRuntime2.mark(googleSignIn),_marked5=_regeneratorRuntime2.mark(googleSignUp),_marked6=_regeneratorRuntime2.mark(facebookSignIn),_marked7=_regeneratorRuntime2.mark(facebookSignUp);var signInEmailStrategy=function signInEmailStrategy(email,password){return(0,_auth.default)().signInWithEmailAndPassword(email,password).then(function _callee(data){var user_object;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:user_object={email:data.user.email,uid:data.user.uid,photoURL:data.user.photoURL,name:data.user.displayName};return _context.abrupt("return",user_object);case 2:case"end":return _context.stop();}}},null,null,null,Promise);}).catch(function(error){if(error.code==='auth/email-already-in-use'){_reactNativeSimpleToast.default.show("El correo ingresado ya esta en uso");console.log('That email address is already in use!');}else if(error.code==='auth/invalid-email'||error.code==='auth/user-not-found'){_reactNativeSimpleToast.default.show("El correo ingresado no es valido");}else if(error.code==='auth/wrong-password'){_reactNativeSimpleToast.default.show("La clave ingresada no es correcta");}else{_reactNativeSimpleToast.default.show("Ocurrio un error al ingresar");console.error(error);}throw error;});};var signUpEmailStrategy=function signUpEmailStrategy(email,password,fullName){return(0,_auth.default)().createUserWithEmailAndPassword(email,password).then(function _callee2(data){var user_object;return _regenerator.default.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:user_object={email:data.user.email,uid:data.user.uid,photoURL:data.user.photoURL,name:fullName};return _context2.abrupt("return",user_object);case 2:case"end":return _context2.stop();}}},null,null,null,Promise);}).catch(function(error){if(error.code==='auth/email-already-in-use'){_reactNativeSimpleToast.default.show("El usuario ya esta registrado en la plataforma");}else if(error.code==='auth/invalid-email'||error.code==='auth/user-not-found'){_reactNativeSimpleToast.default.show("El correo ingresado no es valido");}else{_reactNativeSimpleToast.default.show("Ocurrio un error al ingresar");console.error("error al crear usuario:",error);}throw error;});};var googleSignInStrategy=function googleSignInStrategy(){return _googleSignin.GoogleSignin.signIn().then(function(idToken){var googleCredential=_auth.default.GoogleAuthProvider.credential(idToken.idToken);return(0,_auth.default)().signInWithCredential(googleCredential).then(function(data){console.log("Inicio sesion el usuario: "+data.additionalUserInfo.profile.email);var user_object={email:data.additionalUserInfo.profile.email,uid:data.user.uid,photoURL:data.user.photoURL,name:data.user.displayName};return user_object;}).catch(function(error){if(error.code==='auth/email-already-in-use'){_reactNativeSimpleToast.default.show("El correo ingresado ya se encuentra en uso");console.error('That email address is already in use!');}else if(error.code==='auth/invalid-email'){_reactNativeSimpleToast.default.show("El correo ingresado no es valido");console.error('That email address is invalid!');}else{_reactNativeSimpleToast.default.show("Ocurrio un error al ingresar");console.error(error);}throw error;});});};var facebookSignInStrategy=function facebookSignInStrategy(){return _reactNativeFbsdk.LoginManager.logInWithPermissions(['public_profile','email']).then(function(result){if(result.isCancelled){throw'User cancelled the login process';}return _reactNativeFbsdk.AccessToken.getCurrentAccessToken().then(function(data){if(!data){_reactNativeSimpleToast.default.show("Ocurrio un error al ingresar");throw'Something went wrong obtaining access token';}var facebookCredential=_auth.default.FacebookAuthProvider.credential(data.accessToken);return(0,_auth.default)().signInWithCredential(facebookCredential).then(function _callee3(data){var user_object;return _regenerator.default.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log("Inicio sesion el usuario: "+data.additionalUserInfo.profile.email);user_object={email:data.additionalUserInfo.profile.email,uid:data.user.uid,photoURL:data.user.photoURL,name:data.user.displayName};return _context3.abrupt("return",user_object);case 3:case"end":return _context3.stop();}}},null,null,null,Promise);}).catch(function(error){if(error.code==='auth/email-already-in-use'){console.log('That email address is already in use!');}else if(error.code==='auth/invalid-email'){console.log('That email address is invalid!');}else{console.error(error);}_reactNativeSimpleToast.default.show("Ocurrio un error al ingresar");throw error;});});});};function signUp(action){var _action$payload,email,password,fullName,user,service_user;return _regenerator.default.wrap(function signUp$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_action$payload=action.payload,email=_action$payload.email,password=_action$payload.password,fullName=_action$payload.fullName;_context4.prev=1;_context4.next=4;return(0,_effects.call)(signUpEmailStrategy,email,password,fullName);case 4:user=_context4.sent;service_user={uid:user.uid,lastsign:new Date(),fullname:fullName};_context4.prev=6;_context4.next=9;return(0,_effects.call)(_CreateUser.default,service_user);case 9:_context4.next=11;return(0,_effects.put)({type:_Types.UPDATE_USER,payload:user});case 11:_reactNativeFbsdk.AppEventsLogger.logEvent("fb_mobile_complete_registration");_context4.next=18;break;case 14:_context4.prev=14;_context4.t0=_context4["catch"](6);_reactNativeSimpleToast.default.show("Ocurrio un error al registrar");throw _context4.t0;case 18:_context4.next=24;break;case 20:_context4.prev=20;_context4.t1=_context4["catch"](1);_context4.next=24;return(0,_effects.put)({type:_Types.ERROR,payload:_context4.t1});case 24:case"end":return _context4.stop();}}},_marked,null,[[1,20],[6,14]]);}function logOut(action){return _regenerator.default.wrap(function logOut$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:(0,_auth.default)().signOut();case 1:case"end":return _context5.stop();}}},_marked2);}function signIn(action){var _action$payload2,email,password,strategy,user;return _regenerator.default.wrap(function signIn$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_action$payload2=action.payload,email=_action$payload2.email,password=_action$payload2.password,strategy=_action$payload2.strategy;_context6.prev=1;if(!(strategy=="email")){_context6.next=17;break;}_context6.next=5;return(0,_effects.call)(signInEmailStrategy,email,password);case 5:user=_context6.sent;_context6.prev=6;_context6.next=9;return(0,_effects.call)(_LogIn.default,user.uid);case 9:_context6.next=11;return(0,_effects.put)({type:_Types.UPDATE_USER,payload:user});case 11:_context6.next=17;break;case 13:_context6.prev=13;_context6.t0=_context6["catch"](6);_reactNativeSimpleToast.default.show("Ocurrio un error al ingresar");throw _context6.t0;case 17:_context6.next=23;break;case 19:_context6.prev=19;_context6.t1=_context6["catch"](1);_context6.next=23;return(0,_effects.put)({type:_Types.ERROR,payload:_context6.t1});case 23:case"end":return _context6.stop();}}},_marked3,null,[[1,19],[6,13]]);}function googleSignIn(action){var strategy,user;return _regenerator.default.wrap(function googleSignIn$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:strategy=action.payload.strategy;_context7.prev=1;if(!(strategy=="email")){_context7.next=17;break;}_context7.next=5;return(0,_effects.call)(googleSignInStrategy);case 5:user=_context7.sent;_context7.prev=6;_context7.next=9;return(0,_effects.call)(_LogIn.default,user.uid);case 9:_context7.next=11;return(0,_effects.put)({type:_Types.UPDATE_USER,payload:user});case 11:_context7.next=17;break;case 13:_context7.prev=13;_context7.t0=_context7["catch"](6);_reactNativeSimpleToast.default.show("Ocurrio un error al ingresar");throw _context7.t0;case 17:_context7.next=23;break;case 19:_context7.prev=19;_context7.t1=_context7["catch"](1);_context7.next=23;return(0,_effects.put)({type:_Types.ERROR,payload:_context7.t1});case 23:case"end":return _context7.stop();}}},_marked4,null,[[1,19],[6,13]]);}function googleSignUp(action){var strategy,user,service_user;return _regenerator.default.wrap(function googleSignUp$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:strategy=action.payload.strategy;_context8.prev=1;if(!(strategy=="email")){_context8.next=19;break;}_context8.next=5;return(0,_effects.call)(googleSignInStrategy);case 5:user=_context8.sent;service_user={uid:user.uid,lastsign:new Date(),fullname:user.name};_context8.prev=7;_context8.next=10;return(0,_effects.call)(_CreateUser.default,service_user);case 10:_context8.next=12;return(0,_effects.put)({type:_Types.UPDATE_USER,payload:user});case 12:_reactNativeFbsdk.AppEventsLogger.logEvent("fb_mobile_complete_registration");_context8.next=19;break;case 15:_context8.prev=15;_context8.t0=_context8["catch"](7);_reactNativeSimpleToast.default.show("Ocurrio un error al registrar");throw _context8.t0;case 19:_context8.next=25;break;case 21:_context8.prev=21;_context8.t1=_context8["catch"](1);_context8.next=25;return(0,_effects.put)({type:_Types.ERROR,payload:_context8.t1});case 25:case"end":return _context8.stop();}}},_marked5,null,[[1,21],[7,15]]);}function facebookSignIn(action){var strategy,user;return _regenerator.default.wrap(function facebookSignIn$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:strategy=action.payload.strategy;_context9.prev=1;if(!(strategy=="email")){_context9.next=17;break;}_context9.next=5;return(0,_effects.call)(facebookSignInStrategy);case 5:user=_context9.sent;_context9.prev=6;_context9.next=9;return(0,_effects.call)(_LogIn.default,user.uid);case 9:_context9.next=11;return(0,_effects.put)({type:_Types.UPDATE_USER,payload:user});case 11:_context9.next=17;break;case 13:_context9.prev=13;_context9.t0=_context9["catch"](6);_reactNativeSimpleToast.default.show("Ocurrio un error al ingresar");throw _context9.t0;case 17:_context9.next=23;break;case 19:_context9.prev=19;_context9.t1=_context9["catch"](1);_context9.next=23;return(0,_effects.put)({type:_Types.ERROR,payload:_context9.t1});case 23:case"end":return _context9.stop();}}},_marked6,null,[[1,19],[6,13]]);}function facebookSignUp(action){var strategy,user,service_user;return _regenerator.default.wrap(function facebookSignUp$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:strategy=action.payload.strategy;_context10.prev=1;if(!(strategy=="email")){_context10.next=19;break;}_context10.next=5;return(0,_effects.call)(facebookSignInStrategy);case 5:user=_context10.sent;service_user={uid:user.uid,lastsign:new Date(),fullname:user.name};_context10.prev=7;_context10.next=10;return(0,_effects.call)(_CreateUser.default,service_user);case 10:_context10.next=12;return(0,_effects.put)({type:_Types.UPDATE_USER,payload:user});case 12:_reactNativeFbsdk.AppEventsLogger.logEvent("fb_mobile_complete_registration");_context10.next=19;break;case 15:_context10.prev=15;_context10.t0=_context10["catch"](7);_reactNativeSimpleToast.default.show("Ocurrio un error al registrar");throw _context10.t0;case 19:_context10.next=25;break;case 21:_context10.prev=21;_context10.t1=_context10["catch"](1);_context10.next=25;return(0,_effects.put)({type:_Types.ERROR,payload:_context10.t1});case 25:case"end":return _context10.stop();}}},_marked7,null,[[1,21],[7,15]]);}